# CHANGELOG

Формат: [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/)  
Версионирование: SemVer (привязка к `pubspec.yaml` при релизе)

## [Unreleased]
### Added
-

### Changed
- Профиль: строка версии приложения теперь берётся из платформы (реальные `version+buildNumber`), а не только из хардкода.
- Чат: сообщения о звонках (входящий/исходящий/пропущенный) теперь отображаются отдельными карточками и визуально отличаются от обычных сообщений.

- Правила: `.cursor/rules/20-auto-commit.md` для автоматического коммита после изменений.
- Правила: `.cursor/rules/15-git-files.md` - обязательное добавление всех файлов в git.
- Правила: `.cursor/rules/00-scope.md` — уточнены ограничения и процесс работы.
- Процесс: восстановлены реальные `.cursor/rules`, `.cursor/commands` и `.githooks/pre-commit` (Cursor агентный режим + защита артефактов перед коммитом).
- WebSocket: добавлен fallback на следующий хост при ошибке подключения (для мягкого переезда на `api.orpheus.click`).
- `main.dart`: обработка входящих WS сообщений переведена на `IncomingMessageHandler` (тонкая обвязка вместо логики).
- Документация/процесс: уточнено, что публичные release notes ведём в `OPHEUS_ADMIN` → “Версии” (единый источник “Что нового”).

### Fixed
- Правила: исправлена проблема с неотслеживаемыми файлами - теперь все файлы автоматически добавляются в git.
- Тесты/стабильность: устранены pending timers и флейки в widget-тестах, стабилизированы проверки экранов.
- Звонки: ICE candidate больше не теряется, даже если приходит до `call-offer`.
- Звонки: для `hang-up`/`call-rejected` гарантирован порядок действий — сначала сигнал в `CallScreen`, затем скрытие call-уведомления.

### Removed
- Дублирующие документы по тестам в корне репозитория (перенесено в `docs/testing/README.md`).
- UI: убраны надписи/баннеры про “Сквозное шифрование” в списке контактов и в чате (меньше визуального шума).

## [1.1.0] - 2025-12-12
### Added
- Процесс: единые артефакты разработки (docs, worklog, hooks).
- Android: добавлен `BootReceiver` (автозапуск после перезагрузки) и ресурсы splash для Android 12+.
- Скрипт: `scripts/auto-commit.ps1` для автоматического создания коммитов с проверкой артефактов.
- Документация: `docs/COMMIT_PROCESS.md` с описанием процесса коммита и формата сообщений.
- Документация: `docs/DECISIONS/0002-redis-integration-plan.md` с планом интеграции Redis.
- Документация: `docs/DECISIONS/0003-security-system.md` с решением по безопасности входа.
- Документация: `docs/HOW_TO_GIVE_TASKS.md` с инструкцией, как ставить задачи ИИ.
- Документация: `docs/REPORT_SINCE_2025-12-06.md` — отчёт изменений с версии 0.9.0 (с 06.12.2025).
- Правила: `.cursor/rules/20-auto-commit.md` для автоматического коммита после изменений.
- **Безопасность: система защиты входа с PIN-кодом (6 цифр)**
  - Опциональный PIN-код для защиты приложения
  - Экран блокировки с UI и анимациями
  - Прогрессивная блокировка при неверных попытках
  - Поддержка биометрии (опционально)
- **Безопасность: код принуждения (Duress Code)**
  - Второй PIN-код, который показывает "пустой" профиль
  - Реальные данные остаются скрытыми, но не удаляются (входящие продолжают сохраняться)
- **Безопасность: экстренное удаление данных**
  - Код удаления (wipe code): ввод → подтверждение удержанием → полный wipe
  - Жест panic wipe (3 ухода приложения в фон) — выключен по умолчанию (опционально)
  - Auto-wipe после N неверных попыток (опционально)
- **UI: экран “Как пользоваться”**
  - Встроенная инструкция по ключевым сценариям и функциям безопасности

### Changed
- Профиль: строка версии приложения теперь берётся из платформы (реальные `version+buildNumber`), а не только из хардкода.

### Fixed
- Настройки: устранён `setState() called after dispose()`.
- Звонки: гарантировано, что автолок не мешает ответу/разговору (во время активного звонка автолок не включается).
