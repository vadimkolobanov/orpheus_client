# üîç –ê–£–î–ò–¢ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò ORPHEUS MOBILE CLIENT

**–í–µ—Ä—Å–∏—è:** v1.1.2+8 | Flutter/Dart  
**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 06.02.2026  
**–ê—É–¥–∏—Ç–æ—Ä:** AI Security Analyst (–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ + —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –ò–ë)  
**–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è:** White-box –∞–Ω–∞–ª–∏–∑ –ø–æ–ª–Ω–æ–π –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã –±–µ–∑ –æ–ø–æ—Ä—ã –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏](#-—Ä–∞–∑–¥–µ–ª-1-–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-—É—è–∑–≤–∏–º–æ—Å—Ç–∏)
2. [–°–µ—Ä—å—ë–∑–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](#-—Ä–∞–∑–¥–µ–ª-2-—Å–µ—Ä—å—ë–∑–Ω—ã–µ-–ø—Ä–æ–±–ª–µ–º—ã-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
3. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –Ω–µ–¥–æ—Ä–∞–±–æ—Ç–∫–∏](#-—Ä–∞–∑–¥–µ–ª-3-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ-–Ω–µ–¥–æ—Ä–∞–±–æ—Ç–∫–∏)
4. [–ü—Ä–æ–±–ª–µ–º—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º](#-—Ä–∞–∑–¥–µ–ª-4-–ø—Ä–æ–±–ª–µ–º—ã-—Å-–¥–∞–Ω–Ω—ã–º–∏-–∏-—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º)
5. [–ü—Ä–æ–±–ª–µ–º—ã –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏](#-—Ä–∞–∑–¥–µ–ª-5-–ø—Ä–æ–±–ª–µ–º—ã-–Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏)
6. [–ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è](#-—Ä–∞–∑–¥–µ–ª-6-–∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ-–∑–∞–º–µ—á–∞–Ω–∏—è)
7. [–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã](#-—Ä–∞–∑–¥–µ–ª-7-–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ-–º–æ–º–µ–Ω—Ç—ã)
8. [–°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞](#-—Ä–∞–∑–¥–µ–ª-8-—Å–≤–æ–¥–Ω–∞—è-—Ç–∞–±–ª–∏—Ü–∞)
9. [–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –ø–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π](#-—Ä–∞–∑–¥–µ–ª-9-–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π-–ø–ª–∞–Ω-–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π)

---

## üî¥ –†–∞–∑–¥–µ–ª 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏

### 1.1 TURN-—Å–µ—Ä–≤–µ—Ä: —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ

**–§–∞–π–ª:** `lib/services/webrtc_service.dart:6-21`  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üî¥ CRITICAL

```dart
const Map<String, dynamic> rtcConfiguration = {
  'iceServers': [
    {
      'urls': [
        'turn:213.171.10.108:3478',
        'turn:213.171.10.108:3478?transport=tcp',
        'turn:213.171.10.108:443?transport=tcp',
      ],
      'username': 'orpheus',
      'credential': 'TEST112',
    },
  ],
};
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –õ–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å TURN-—Å–µ—Ä–≤–µ—Ä–∞ –∑–∞—à–∏—Ç—ã –ø—Ä—è–º–æ –≤ –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
- –õ—é–±–æ–π –º–æ–∂–µ—Ç –¥–µ–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å APK –∏ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ TURN-—Å–µ—Ä–≤–µ—Ä—É
- IP-–∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ `213.171.10.108` —Ä–∞—Å–∫—Ä—ã—Ç –Ω–∞–ø—Ä—è–º—É—é
- Credential –Ω–∞–∑–≤–∞–Ω ¬´TEST112¬ª ‚Äî —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TURN-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ –∑–∞ –≤–∞—à —Å—á—ë—Ç

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ü–æ–ª—É—á–∞—Ç—å TURN-credentials —á–µ—Ä–µ–∑ authenticated API —Å –∫–æ—Ä–æ—Ç–∫–∏–º TTL (time-limited credentials)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HMAC-based TURN auth (RFC 5766)
- –§–æ—Ä–º–∞—Ç: `username = timestamp:userId`, `credential = HMAC-SHA1(timestamp:userId, sharedSecret)`

---

### 1.2 –õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ù–ï –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∞

**–§–∞–π–ª:** `lib/services/database_service.dart`  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üî¥ CRITICAL

```dart
final db = await openDatabase(
  path, 
  version: 4, 
  onCreate: _createDB, 
  onUpgrade: _upgradeDB,
  singleInstance: true,
);
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π `sqflite` –±–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- –§–∞–π–ª `orpheus.db` —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ –Ω–∞ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
- –ù–∞ —Ä—É—Ç–æ–≤–∞–Ω–Ω—ã—Ö/jailbroken —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –≤—Å—è –ø–µ—Ä–µ–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ plain text
- –î–ª—è –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ —Å E2E —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º —ç—Ç–æ **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π** –ø—Ä–æ–±–µ–ª ‚Äî —Å–æ–æ–±—â–µ–Ω–∏—è —à–∏—Ñ—Ä—É—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ, –Ω–æ —Ö—Ä–∞–Ω—è—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç–æ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ó–∞–º–µ–Ω–∏—Ç—å `sqflite` –Ω–∞ `sqflite_sqlcipher` –∏–ª–∏ `sqflite_common_ffi` —Å SQLCipher
- –ö–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –ë–î –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∏ —Ö—Ä–∞–Ω–∏—Ç—å –≤ `flutter_secure_storage`
- –ü—Ä–∏ wipe —É–¥–∞–ª—è—Ç—å –∫–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (–ë–î —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ—á–∏—Ç–∞–µ–º–æ–π –¥–∞–∂–µ –±–µ–∑ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è)

---

### 1.3 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Certificate Pinning

**–§–∞–π–ª:** –í—Å–µ HTTP/WebSocket –≤—ã–∑–æ–≤—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üî¥ CRITICAL

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–∏ –æ–¥–∏–Ω HTTP-–∫–ª–∏–µ–Ω—Ç –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç certificate pinning
- –ù–∏ WebSocket, –Ω–∏ REST-–∑–∞–ø—Ä–æ—Å—ã –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–µ—Ä–≤–µ—Ä–∞
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—è–∑–≤–∏–º–æ –∫ MITM-–∞—Ç–∞–∫–µ —á–µ—Ä–µ–∑ –ø–æ–¥–º–µ–Ω—É —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π proxy, —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Wi-Fi)
- –î–ª—è –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ —Å focus –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —ç—Ç–æ **–Ω–µ–ø—Ä–∏–µ–º–ª–µ–º–æ**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –í–Ω–µ–¥—Ä–∏—Ç—å SSL pinning —á–µ—Ä–µ–∑ –ø–∞–∫–µ—Ç `http_certificate_pinning` –∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–π `SecurityContext`
- –ü–∏–Ω–Ω–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (SPKI pin), –Ω–µ —Å–∞–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
- –ò–º–µ—Ç—å backup pin –¥–ª—è —Ä–æ—Ç–∞—Ü–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- –ü—Ä–∏–º–µ–Ω–∏—Ç—å pinning –∏ –¥–ª—è WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —á–µ—Ä–µ–∑ –∫–∞—Å—Ç–æ–º–Ω—ã–π `HttpClient`

---

### 1.4 –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ PIN: —Å–ª–∞–±—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º

**–§–∞–π–ª:** `lib/services/auth_service.dart:464-476`  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üî¥ CRITICAL

```dart
String _hashPin(String pin, String salt) {
  // –ü—Ä–æ—Å—Ç–∞—è —Å—Ö–µ–º–∞: SHA-256(salt + pin + salt) –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω–∞—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
  // –î–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è Argon2id, –Ω–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —ç—Ç–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
  final saltBytes = base64.decode(salt);
  var data = [...saltBytes, ...utf8.encode(pin), ...saltBytes];
  
  // 10000 –∏—Ç–µ—Ä–∞—Ü–∏–π –¥–ª—è –∑–∞–º–µ–¥–ª–µ–Ω–∏—è brute-force
  for (var i = 0; i < 10000; i++) {
    data = sha256.convert(data).bytes;
  }
  
  return base64.encode(data);
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω—ã–π SHA-256 –≤–º–µ—Å—Ç–æ Argon2id/bcrypt/scrypt
- –í –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞–ø–∏—Å–∞–Ω–æ ¬´–¥–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è Argon2id¬ª ‚Äî –Ω–æ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- SHA-256 —Å 10K –∏—Ç–µ—Ä–∞—Ü–∏–π ‚Äî –∫—Ä–∞–π–Ω–µ —Å–ª–∞–±–∞—è –∑–∞—â–∏—Ç–∞ –ø—Ä–æ—Ç–∏–≤ GPU-brute-force
- PIN-–∫–æ–¥ 4-6 —Ü–∏—Ñ—Ä = –º–∞–∫—Å–∏–º—É–º 1 000 000 –∫–æ–º–±–∏–Ω–∞—Ü–∏–π. –° GPU –ø–µ—Ä–µ–±–æ—Ä –∑–∞ —Å–µ–∫—É–Ω–¥—ã
- SHA-256 –Ω–µ memory-hard, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –µ–≥–æ —É—è–∑–≤–∏–º—ã–º –¥–ª—è ASIC-–∞—Ç–∞–∫

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ Argon2id
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: `memory=64MB`, `iterations=3`, `parallelism=4`
- –ü–∞–∫–µ—Ç—ã: `argon2_ffi`, `hashlib`, –∏–ª–∏ `dargon2_flutter`

---

### 1.5 Sentry DSN –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –∫–æ–¥–µ

**–§–∞–π–ª:** `lib/main.dart`  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üî¥ CRITICAL

**–ü—Ä–æ–±–ª–µ–º–∞:**
- DSN Sentry —Å–æ–¥–µ—Ä–∂–∏—Ç authentication token –∏ project ID
- –î–æ—Å—Ç—É–ø–µ–Ω –ø—Ä–∏ –¥–µ–∫–æ–º–ø–∏–ª—è—Ü–∏–∏ APK
- –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –∑–∞—Å–æ—Ä—è—Ç—å Sentry —Ñ–µ–π–∫–æ–≤—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏ (DoS –Ω–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- –ú–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –•—Ä–∞–Ω–∏—Ç—å DSN –≤ build-time –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è: `--dart-define=SENTRY_DSN=xxx`
- –ù–µ –∫–æ–º–º–∏—Ç–∏—Ç—å DSN –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å rate limiting –≤ Sentry –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Å–ø–∞–º–∞

---

## üü† –†–∞–∑–¥–µ–ª 2: –°–µ—Ä—å—ë–∑–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 2.1 CryptoService ‚Äî –Ω–µ singleton, —Å–æ–∑–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ new

**–§–∞–π–ª:** `lib/services/crypto_service.dart`  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üü† HIGH

```dart
// –≤ auth_service.dart:422-428:
Future<void> performWipe() async {
  // 1. –£–¥–∞–ª—è–µ–º –∫—Ä–∏–ø—Ç–æ–∫–ª—é—á–∏
  final cryptoService = CryptoService(); // –ù–û–í–´–ô —ç–∫–∑–µ–º–ø–ª—è—Ä!
  await cryptoService.deleteAccount();
  // ...
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `CryptoService` –ù–ï singleton, –Ω–æ —Ö—Ä–∞–Ω–∏—Ç –∫–ª—é—á–∏ –≤ –ø–∞–º—è—Ç–∏ (`_keyPair`, `_publicKey`)
- –ü—Ä–∏ –∫–∞–∂–¥–æ–º `new CryptoService()` —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä —Å –ø—É—Å—Ç—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- –í `performWipe()` —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä ‚Äî –∫–ª—é—á–∏ –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ **–ù–ï –∑–∞–Ω—É–ª—è—é—Ç—Å—è**
- –ö–ª—é—á–∏ –º–æ–≥—É—Ç –æ—Å—Ç–∞—Ç—å—Å—è –≤ RAM –ø–æ—Å–ª–µ wipe

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –°–¥–µ–ª–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π singleton –∏–ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∏–Ω—Å—Ç–∞–Ω—Å —á–µ—Ä–µ–∑ DI
- –ü—Ä–∏ wipe –æ–±–Ω—É–ª—è—Ç—å –∫–ª—é—á–∏ –≤ **–∫–∞–∂–¥–æ–º** –∂–∏–≤–æ–º —ç–∫–∑–µ–º–ø–ª—è—Ä–µ
- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `zeroize()` –¥–ª—è —è–≤–Ω–æ–≥–æ –∑–∞–Ω—É–ª–µ–Ω–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏

---

### 2.2 –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –º–æ–∂–µ—Ç —É—Ç–µ—á—å —á–µ—Ä–µ–∑ –ª–æ–≥–∏

**–§–∞–π–ª:** –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ (170+ –≤—ã–∑–æ–≤–æ–≤ `print()`)  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üü† HIGH

**–ü—Ä–æ–±–ª–µ–º–∞:**
- 170+ –≤—ã–∑–æ–≤–æ–≤ `print()` –≤ production –∫–æ–¥–µ –ø–æ –≤—Å–µ–º—É –ø—Ä–æ–µ–∫—Ç—É
- –õ–æ–≥–∏—Ä—É—é—Ç—Å—è: FCM token, public keys (—á–∞—Å—Ç–∏—á–Ω–æ), —Å—Ç–∞—Ç—É—Å—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, callId
- –•–æ—Ç—è –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –Ω–µ –ø–µ—á–∞—Ç–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è **–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞**
- Android logcat –¥–æ—Å—Ç—É–ø–µ–Ω –¥—Ä—É–≥–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º –Ω–∞ debug-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- `print("–ö–ª—é—á–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã.")` ‚Äî —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫—Ä–∏–ø—Ç–æ—Å–∏—Å—Ç–µ–º—ã
- `print("AUTH: PIN –≤–µ—Ä–Ω—ã–π")` ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —É—Å–ø–µ—à–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –≤ logcat

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã:**

| –§–∞–π–ª | –ö–æ–ª-–≤–æ print() |
|------|----------------|
| notification_service.dart | 27 |
| auth_service.dart | 23 |
| database_service.dart | 21 |
| websocket_service.dart | 21 |
| call_id_storage.dart | 15 |
| pending_actions_service.dart | 12 |
| sound_service.dart | 10 |
| main.dart | 6 |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –£–¥–∞–ª–∏—Ç—å –≤—Å–µ `print()` –∏–∑ production
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `DebugLogger` —Å —É—Ä–æ–≤–Ω—è–º–∏
- –í release-—Ä–µ–∂–∏–º–µ –æ—Ç–∫–ª—é—á–∏—Ç—å –≤—ã–≤–æ–¥ –≤ logcat —á–µ—Ä–µ–∑ `debugPrint = (String? message, {int? wrapWidth}) {}`

---

### 2.3 –ë–∏–æ–º–µ—Ç—Ä–∏—è: –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è!

**–§–∞–π–ª:** `lib/screens/security_settings_screen.dart:147`  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üü† HIGH

```dart
if (didAuth) {
  // TODO: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É –±–∏–æ–º–µ—Ç—Ä–∏–∏ –≤ AuthService
  ScaffoldMessenger.of(context).showSnackBar(
    SnackBar(content: Text(l10n.biometryEnabled)),
  );
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –±–∏–æ–º–µ—Ç—Ä–∏–µ–π ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ **–Ω–µ –ø–µ—Ä—Å–∏—Å—Ç–∏—Ç—Å—è**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∫–ª—é—á–∞–µ—Ç –±–∏–æ–º–µ—Ç—Ä–∏—é, –Ω–æ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –æ–Ω–∞ ¬´–∑–∞–±—ã–≤–∞–µ—Ç—Å—è¬ª
- –≠—Ç–æ –ø—Ä—è–º–æ–π –±–∞–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ ‚Äî —Ñ–∏—á–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥—É–º–∞–µ—Ç, —á—Ç–æ –±–∏–æ–º–µ—Ç—Ä–∏—è –≤–∫–ª—é—á–µ–Ω–∞, –Ω–æ —ç—Ç–æ –Ω–µ —Ç–∞–∫

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `AuthService`
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `isBiometricEnabled` –≤ `SecurityConfig` (—É–∂–µ –µ—Å—Ç—å) –∏ –≤—ã–∑—ã–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

---

### 2.4 WebSocket: –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ URL

**–§–∞–π–ª:** `lib/config.dart:26-29`  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üü† HIGH

```dart
static String webSocketUrl(String publicKey, {String? host}) {
  final encodedPublicKey = Uri.encodeComponent(publicKey);
  final h = host ?? serverIp;
  return 'wss://$h/ws/$encodedPublicKey';
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ URL ‚Äî –æ–Ω –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö
- –ü–æ–ø–∞–¥–∞–µ—Ç –≤ access-–ª–æ–≥–∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞, CDN, Nginx
- –í–∏–¥–∏–º –≤ HTTP Referer –ø—Ä–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞—Ö
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—é –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∫–ª—é—á —á–µ—Ä–µ–∑ WebSocket handshake header (`Sec-WebSocket-Protocol` –∏–ª–∏ custom header)
- –ò–ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∫–∞–∫ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- URL –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ session token

---

### 2.5 HTTP Signaling: –Ω–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–§–∞–π–ª:** `lib/services/websocket_service.dart:358-397`  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üü† HIGH

```dart
final body = json.encode({
  'sender_pubkey': _currentPublicKey,
  'recipient_pubkey': recipientPublicKey,
  'signal_type': signalType,
  'data': data,
});
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- HTTP fallback –¥–ª—è —Å–∏–≥–Ω–∞–ª–æ–≤ (call-offer, hang-up –∏ –¥—Ä.) –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `sender_pubkey` –≤ —Ç–µ–ª–µ
- **–ù–µ—Ç –ø–æ–¥–ø–∏—Å–∏, –Ω–µ—Ç —Ç–æ–∫–µ–Ω–∞** ‚Äî –ª—é–±–æ–π –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å `hang-up` –æ—Ç –∏–º–µ–Ω–∏ –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í–æ–∑–º–æ–∂–Ω–∞ –∞—Ç–∞–∫–∞: –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —á—É–∂–∏—Ö –∑–≤–æ–Ω–∫–æ–≤
- –ú–æ–∂–Ω–æ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∂–Ω—ã–µ call-offer –¥–ª—è DoS

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ü–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å –∫–∞–∂–¥—ã–π signal-–∑–∞–ø—Ä–æ—Å –ø—Ä–∏–≤–∞—Ç–Ω—ã–º –∫–ª—é—á–æ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
- –°–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å Ed25519 –ø–æ–¥–ø–∏—Å—å
- –î–æ–±–∞–≤–∏—Ç—å timestamp + nonce –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç replay-–∞—Ç–∞–∫

---

### 2.6 Wipe –ø—Ä–∏ –æ—à–∏–±–∫–µ ‚Äî fail-open

**–§–∞–π–ª:** `lib/services/auth_service.dart:422-452`  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üü† HIGH

```dart
Future<void> performWipe() async {
  try {
    // 1. –£–¥–∞–ª—è–µ–º –∫—Ä–∏–ø—Ç–æ–∫–ª—é—á–∏
    final cryptoService = CryptoService();
    await cryptoService.deleteAccount();
    
    // 2. –ó–∞–∫—Ä—ã–≤–∞–µ–º –∏ —É–¥–∞–ª—è–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
    await DatabaseService.instance.deleteDatabaseFile();
    
    // 3. –£–¥–∞–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    try {
      final prefs = await SharedPreferences.getInstance();
      await prefs.clear();
    } catch (_) {}
    
    // 4. –£–¥–∞–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    await _secureStorage.delete(key: _configKey);
    
    // 5. –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    _config = SecurityConfig.empty;
    _isUnlocked = false;
    _isDuressMode = false;
  } catch (e) {
    print("AUTH ERROR: –û—à–∏–±–∫–∞ wipe: $e");
    rethrow;
  }
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ –ª—é–±–æ–π —à–∞–≥ wipe –ø–∞–¥–∞–µ—Ç —Å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º ‚Äî **–ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ù–ï –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è**
- –ù–∞–ø—Ä–∏–º–µ—Ä: –µ—Å–ª–∏ `deleteAccount()` —É–ø–∞–ª ‚Äî –ë–î –∏ SharedPreferences **–æ—Å—Ç–∞—é—Ç—Å—è**
- –ü—Ä–∏ auto-wipe –ø–æ—Å–ª–µ brute-force –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç —á–∞—Å—Ç–∏—á–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è
- `rethrow` –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ ‚Äî –¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞—á–∏—â–µ–Ω—ã

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```dart
Future<void> performWipe() async {
  // Best-effort wipe: –∫–∞–∂–¥—ã–π —à–∞–≥ –Ω–µ–∑–∞–≤–∏—Å–∏–º
  try { await CryptoService.instance.deleteAccount(); } catch (_) {}
  try { await DatabaseService.instance.deleteDatabaseFile(); } catch (_) {}
  try { (await SharedPreferences.getInstance()).clear(); } catch (_) {}
  try { await _secureStorage.delete(key: _configKey); } catch (_) {}
  
  _config = SecurityConfig.empty;
  _isUnlocked = false;
  _isDuressMode = false;
}
```

---

## üü° –†–∞–∑–¥–µ–ª 3: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –Ω–µ–¥–æ—Ä–∞–±–æ—Ç–∫–∏

### 3.1 Singleton-–∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω –ø–æ–≤—Å—é–¥—É

**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üü° MEDIUM

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `DatabaseService.instance`, `AuthService.instance`, `TelemetryService.instance`, `MessageCleanupService.instance` ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–µ singleton
- –ñ—ë—Å—Ç–∫–∞—è —Å–≤—è–∑–Ω–æ—Å—Ç—å: `DatabaseService` –Ω–∞–ø—Ä—è–º—É—é —á–∏—Ç–∞–µ—Ç `AuthService.instance.isDuressMode`
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–¥–º–µ–Ω–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –±–µ–∑ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
- –ó–∞—Ç—Ä—É–¥–Ω—è–µ—Ç unit-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ö–æ—Ç—è –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö –µ—Å—Ç—å DI —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã ‚Äî –Ω–µ–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –í–Ω–µ–¥—Ä–∏—Ç—å Dependency Injection (—á–µ—Ä–µ–∑ `provider`, `get_it`, –∏–ª–∏ `riverpod`)
- –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã (–∫–∞–∫ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ –≤ `IncomingMessageHandler`)

---

### 3.2 `main.dart` ‚Äî God Object

**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üü° MEDIUM

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `main.dart` —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–æ—Ç–Ω–∏ —Å—Ç—Ä–æ–∫ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- CallKit –æ–±—Ä–∞–±–æ—Ç–∫–∞, WebSocket messages, –Ω–∞–≤–∏–≥–∞—Ü–∏—è, lifecycle ‚Äî –≤—Å—ë –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
- –ù–∞—Ä—É—à–µ–Ω–∏–µ Single Responsibility Principle
- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: `websocketService`, `cryptoService`, `authService` –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ñ–∞–π–ª–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –í—ã–Ω–µ—Å—Ç–∏ CallKit handling –≤ `CallKitService`
- –í—ã–Ω–µ—Å—Ç–∏ navigation logic –≤ `NavigationService`
- –í—ã–Ω–µ—Å—Ç–∏ message processing (—É–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ –≤ `IncomingMessageHandler`)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ServiceLocator` –∏–ª–∏ DI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

---

### 3.3 WebRTCService: –Ω–µ—Ç dispose() –¥–ª—è StreamControllers

**–§–∞–π–ª:** `lib/services/webrtc_service.dart`  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üü° MEDIUM

```dart
final _debugLogController = StreamController<String>.broadcast();
final _iceRestartNeededController = StreamController<void>.broadcast();
// ...
Future<void> hangUp() async {
  // StreamControllers –ù–ï –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è!
  _localStream?.getTracks().forEach((track) => track.stop());
  // ...
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `_debugLogController` –∏ `_iceRestartNeededController` ‚Äî broadcast StreamControllers
- –ú–µ—Ç–æ–¥ `hangUp()` **–Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç** —ç—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–≤–æ–Ω–∫–∞—Ö –∑–∞ —Å–µ—Å—Å–∏—é

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å `dispose()` –º–µ—Ç–æ–¥, –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–π –≤—Å–µ StreamControllers
- –í—ã–∑—ã–≤–∞—Ç—å –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —Å–µ—Ä–≤–∏—Å–∞

---

### 3.4 –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ CallKit/CallId

**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üü° MEDIUM

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `_extractOrGenerateCallId()` –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤:
  - `lib/services/notification_service.dart`
  - `lib/services/incoming_message_handler.dart`
- `_showCallKitIncoming()` —Ç–æ–∂–µ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è ‚Äî 2 —Ä–∞–∑–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ —Ä–∞–∑–Ω—ã–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º
- –õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –≤ 2 –º–µ—Å—Ç–∞—Ö ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏ –±–∞–≥–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –í—ã–Ω–µ—Å—Ç–∏ –≤ –µ–¥–∏–Ω—ã–π shared utility –∫–ª–∞—Å—Å `CallKitUtils`
- –û–±–µ—Å–ø–µ—á–∏—Ç—å –µ–¥–∏–Ω—É—é —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞ –¥–ª—è –ø–æ–∫–∞–∑–∞ CallKit UI

---

### 3.5 Race condition –≤ PendingActionsService

**–§–∞–π–ª:** `lib/services/pending_actions_service.dart`  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üü° MEDIUM

```dart
static Future<void> addPendingMessage({...}) async {
  final prefs = await _prefs();
  final existing = prefs.getStringList(_pendingMessagesKey) ?? [];
  existing.add(messageData);
  await prefs.setStringList(_pendingMessagesKey, existing);
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `addPendingMessage()` ‚Äî read-modify-write –±–µ–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –î–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–∞ –º–æ–≥—É—Ç –ø–æ—Ç–µ—Ä—è—Ç—å –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
- SharedPreferences –Ω–µ thread-safe –¥–ª—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –≤ `addPendingRejection()`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å –º—å—é—Ç–µ–∫—Å/lock (–Ω–∞–ø—Ä–∏–º–µ—Ä, `synchronized` –∏–∑ –ø–∞–∫–µ—Ç–∞ `synchronized`)
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å

---

## üü° –†–∞–∑–¥–µ–ª 4: –ü—Ä–æ–±–ª–µ–º—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º

### 4.1 –ù–µ—Ç –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ messages

**–§–∞–π–ª:** `lib/services/database_service.dart:109-121`  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üü° MEDIUM

```dart
Future<void> _createMessagesTable(Database db) async {
  await db.execute('''
    CREATE TABLE messages (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      contactPublicKey TEXT NOT NULL, 
      text TEXT NOT NULL,
      isSentByMe INTEGER NOT NULL,
      timestamp INTEGER NOT NULL,
      status INTEGER DEFAULT 1,
      isRead INTEGER DEFAULT 1
    )
  ''');
  // –ù–ï–¢ –ò–ù–î–ï–ö–°–û–í!
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç INDEX –Ω–∞ `contactPublicKey` ‚Äî –∫–∞–∂–¥—ã–π `getMessagesForContact()` = full table scan
- –ù–µ—Ç INDEX –Ω–∞ `timestamp` ‚Äî `deleteMessagesOlderThan()` –º–µ–¥–ª–µ–Ω–Ω—ã–π
- –ù–µ—Ç INDEX –Ω–∞ `isRead` ‚Äî –ø–æ–¥—Å—á—ë—Ç –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Ç–æ–∂–µ –º–µ–¥–ª–µ–Ω–Ω—ã–π
- –° —Ä–æ—Å—Ç–æ–º –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–≥—Ä–∞–¥–∏—Ä—É–µ—Ç –ª–∏–Ω–µ–π–Ω–æ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ –≤–µ—Ä—Å–∏–∏ 5:
```sql
CREATE INDEX idx_messages_contact ON messages(contactPublicKey);
CREATE INDEX idx_messages_timestamp ON messages(timestamp);
CREATE INDEX idx_messages_unread ON messages(contactPublicKey, isRead) WHERE isRead = 0;
```

---

### 4.2 –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î ‚Äî silent catch

**–§–∞–π–ª:** `lib/services/database_service.dart:76-86`  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üü° MEDIUM

```dart
if (oldVersion < 3) {
  try {
    await db.execute("ALTER TABLE messages ADD COLUMN status INTEGER DEFAULT 1");
  } catch (e) {
    print("DB: –ö–æ–ª–æ–Ω–∫–∞ status —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –æ—à–∏–±–∫–∞: $e");
  }
  try {
    await db.execute("ALTER TABLE messages ADD COLUMN isRead INTEGER DEFAULT 1");
  } catch (e) {
    print("DB: –ö–æ–ª–æ–Ω–∫–∞ isRead —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –æ—à–∏–±–∫–∞: $e");
  }
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ `ALTER TABLE` –æ—à–∏–±–∫–∏ –º–æ–ª—á–∞ –ø—Ä–æ–≥–ª–∞—Ç—ã–≤–∞—é—Ç—Å—è
- –ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è —á–∞—Å—Ç–∏—á–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ ‚Äî –ë–î –≤ inconsistent state
- –ù–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
- –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `print()` ‚Äî —Ç–µ—Ä—è—é—Ç—Å—è –≤ production

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ –∫–æ–ª–æ–Ω–∫–∏ —á–µ—Ä–µ–∑ `PRAGMA table_info` –ø–µ—Ä–µ–¥ `ALTER TABLE`
- –í—ã–ø–æ–ª–Ω—è—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –≤ Sentry, –Ω–µ —Ç–æ–ª—å–∫–æ print

---

### 4.3 verifyPin() ‚Äî async –≤—ã–∑–æ–≤—ã –±–µ–∑ await

**–§–∞–π–ª:** `lib/services/auth_service.dart:164`  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üü° MEDIUM

```dart
PinVerifyResult verifyPin(String pin) {  // –ù–ï async!
  // ...
  if (hash == _config.pinHash) {
    _resetFailedAttempts();  // async, –Ω–æ –ù–ï awaited!
    _isUnlocked = true;
    return PinVerifyResult.success;
  }
  // ...
  _incrementFailedAttempts();  // async, –Ω–æ –ù–ï awaited!
  return PinVerifyResult.invalid;
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `verifyPin()` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–µ—Ç–æ–¥, –Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç async `_resetFailedAttempts()` –∏ `_incrementFailedAttempts()`
- –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ù–ï awaited
- –ü—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—ã–∑–æ–≤–µ –∫–æ–Ω—Ñ–∏–≥ –º–æ–∂–µ—Ç –Ω–µ —É—Å–ø–µ—Ç—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è
- `failedAttempts` –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–µ –º–µ–∂–¥—É –ø–∞–º—è—Ç—å—é –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –°–¥–µ–ª–∞—Ç—å `verifyPin()` async –∏ await-–∏—Ç—å –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å –≤ –ø–∞–º—è—Ç–∏ —Å –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–π –∑–∞–ø–∏—Å—å—é —á–µ—Ä–µ–∑ debounce

---

## üîµ –†–∞–∑–¥–µ–ª 5: –ü—Ä–æ–±–ª–µ–º—ã –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏

### 5.1 Duress mode: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ, –Ω–æ –Ω–µ –∏—Å—Ö–æ–¥—è—â–∏–µ

**–§–∞–π–ª:** `lib/services/database_service.dart:231-237`  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üîµ LOW-MEDIUM

```dart
Future<void> addMessage(ChatMessage message, String contactKey) async {
  // –í duress mode —Å–æ–æ–±—â–µ–Ω–∏—è –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ–º, –Ω–æ –≤—Ö–æ–¥—è—â–∏–µ –≤—Å—ë —Ä–∞–≤–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º,
  // —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Ç–µ—Ä—è–ª –¥–∞–Ω–Ω—ã–µ.
  
  final db = await instance.database;
  await db.insert('messages', message.toMap(contactKey));
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í duress mode –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–∏—à—É—Ç—Å—è –≤ –ë–î, –Ω–æ –∫–æ–Ω—Ç–∞–∫—Ç—ã ¬´—Å–∫—Ä—ã—Ç—ã¬ª
- –ü–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ duress mode —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç ¬´–Ω–µ–≤–∏–¥–∏–º—ã—Ö¬ª –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –ø–æ—è–≤—è—Ç—Å—è
- –ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø–æ—Ç–æ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ—Å—å –ª–∏ –æ–Ω–æ (timing attack)
- –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è: –∫–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ "–ø—É—Å—Ç—ã–µ", –Ω–æ –¥–∞–Ω–Ω—ã–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –í duress mode –ù–ï —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–æ–æ–±—â–µ
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é "—á–∏—Å—Ç—É—é" –ë–î, –∫–æ—Ç–æ—Ä–∞—è —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ duress mode

---

### 5.2 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ iOS –ø–æ–¥–¥–µ—Ä–∂–∫–∏

**–§–∞–π–ª:** `pubspec.yaml`, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `flutter_launcher_icons`  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üîµ INFO

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `ios: false` –≤ launcher icons
- –§–∞–π–ª `ios/Runner/Info.plist` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ workspace
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ —Ç–æ–ª—å–∫–æ –Ω–∞ Android

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ï—Å–ª–∏ iOS –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è ‚Äî —è–≤–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å
- –ï—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è ‚Äî –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å Notification Service Extension –¥–ª—è VoIP push

---

### 5.3 WebSocket: –Ω–µ—Ç timeout –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**–§–∞–π–ª:** `lib/services/websocket_service.dart:120`  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üîµ LOW-MEDIUM

```dart
WebSocket.connect(uri.toString()).then((ws) => { ... });
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `WebSocket.connect()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ë–ï–ó timeout
- –ü—Ä–∏ –º–µ–¥–ª–µ–Ω–Ω–æ–π —Å–µ—Ç–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–Ω—É—Ç—å –Ω–∞ –º–∏–Ω—É—Ç—ã
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç ¬´Connecting...¬ª –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
- Backoff timer –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è, –ø–æ–∫–∞ connect –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å `.timeout(Duration(seconds: 10))` –∫ `WebSocket.connect()`
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å `TimeoutException` –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ reconnect

---

### 5.4 Pending messages: –Ω–µ—Ç TTL –∏ –Ω–µ—Ç –ª–∏–º–∏—Ç–∞

**–§–∞–π–ª:** `lib/services/pending_actions_service.dart`  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üîµ LOW-MEDIUM

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –û—á–µ—Ä–µ–¥—å pending messages —Ä–∞—Å—Ç—ë—Ç –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- –ù–µ—Ç TTL ‚Äî —Å–æ–æ–±—â–µ–Ω–∏—è 3-–¥–Ω–µ–≤–Ω–æ–π –¥–∞–≤–Ω–æ—Å—Ç–∏ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã
- –ù–µ—Ç –ª–∏–º–∏—Ç–∞ ‚Äî –µ—Å–ª–∏ offline –¥–æ–ª–≥–æ, SharedPreferences –ø–µ—Ä–µ–ø–æ–ª–Ω–∏—Ç—Å—è
- Timestamp —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å `maxAge` (24 —á–∞—Å–∞) ‚Äî –æ—Ç–±—Ä–∞—Å—ã–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ
- –î–æ–±–∞–≤–∏—Ç—å `maxQueue` (100 —Å–æ–æ–±—â–µ–Ω–∏–π) ‚Äî –æ—Ç–±—Ä–∞—Å—ã–≤–∞—Ç—å oldest –ø—Ä–∏ overflow
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å TTL –≤ `_sendPendingMessages()`

---

### 5.5 TelemetryService: –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ HTTP header

**–§–∞–π–ª:** `lib/services/telemetry_service.dart`  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üîµ LOW-MEDIUM

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `X-Pubkey: <base64_public_key>` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –∫–∞–∂–¥—ã–º batch –ª–æ–≥–æ–≤
- –õ–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç device info, app version, network state
- –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ —Å device fingerprint = –¥–µ–∞–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è
- –ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç –∑–∞—è–≤–ª–µ–Ω–Ω–æ–π –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç–∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π ephemeral ID –¥–ª—è —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏, –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π –∫ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–º—É –∫–ª—é—á—É
- –ò–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å HMAC –æ—Ç pubkey —Å —Å–µ–∫—Ä–µ—Ç–æ–º, –∏–∑–≤–µ—Å—Ç–Ω—ã–º —Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä—É

---

### 5.6 SoundService: dispose() –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω

**–§–∞–π–ª:** `lib/services/sound_service.dart:223`  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üîµ LOW

```dart
// Future<void> dispose() async { ... }
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –†–µ—Å—É—Ä—Å—ã AudioPlayer –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è
- –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ —É—Ç–µ—á–∫–µ –Ω–∞—Ç–∏–≤–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `dispose()` –∏ –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

## üü£ –†–∞–∑–¥–µ–ª 6: –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 6.1 X25519 shared secret –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é

**–§–∞–π–ª:** `lib/services/crypto_service.dart:167-174`  
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üü£ CRYPTO

```dart
final sharedSecret = await algorithm.sharedSecretKey(
  keyPair: myKeyPair,
  remotePublicKey: recipientPublicKey,
);

final messageBytes = utf8.encode(message);
final secretBox = await cipher.encrypt(messageBytes, secretKey: sharedSecret);
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –†–µ–∑—É–ª—å—Ç–∞—Ç ECDH (`sharedSecretKey`) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∫–∞–∫ –∫–ª—é—á –¥–ª—è ChaCha20-Poly1305
- –ù–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è KDF (HKDF) –¥–ª—è –¥–µ—Ä–∏–≤–∞—Ü–∏–∏ –∫–ª—é—á–∞
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞: `ECDH result ‚Üí HKDF ‚Üí session key`
- –ë–µ–∑ KDF –Ω–µ—Ç domain separation –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è–º–∏ –∫–ª—é—á–∞
- –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–µ—Ä–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ü–µ–ª–µ–π (MAC, encryption)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ü—Ä–∏–º–µ–Ω–∏—Ç—å HKDF —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º (info) –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–∞–∫ symmetric key
- –§–æ—Ä–º–∞—Ç: `HKDF-SHA256(ikm=shared_secret, salt=random, info="orpheus-chat-v1")`

---

### 6.2 –ù–µ—Ç —Ä–æ—Ç–∞—Ü–∏–∏ –∫–ª—é—á–µ–π (Forward Secrecy)

**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üü£ CRYPTO

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ X25519 keypair –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞ –≤–µ—Å—å —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ –∞–∫–∫–∞—É–Ω—Ç–∞
- –ù–µ—Ç Forward Secrecy ‚Äî –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è –∫–ª—é—á–∞ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç **–í–°–Æ** –∏—Å—Ç–æ—Ä–∏—é –ø–µ—Ä–µ–ø–∏—Å–∫–∏
- –í Signal Protocol –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Double Ratchet –¥–ª—è PFS
- –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è —à–∏—Ñ—Ä—É—é—Ç—Å—è –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ shared secret —Å –∫–∞–∂–¥—ã–º –∫–æ–Ω—Ç–∞–∫—Ç–æ–º

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ú–∏–Ω–∏–º—É–º: —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ephemeral key exchange –¥–ª—è –∫–∞–∂–¥–æ–π —Å–µ—Å—Å–∏–∏
- –ò–¥–µ–∞–ª—å–Ω–æ: Double Ratchet Algorithm (–∫–∞–∫ –≤ Signal Protocol)
- –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –æ–±–Ω–æ–≤–ª—è—Ç—å shared secret —á–µ—Ä–µ–∑ HKDF chain

---

### 6.3 Nonce –¥–ª—è ChaCha20 –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π

**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** üü£ CRYPTO

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Nonce —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ `cipher.encrypt()`
- –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å nonce
- –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ nonce —Å —Ç–µ–º –∂–µ –∫–ª—é—á–æ–º ‚Äî **–ø–æ–ª–Ω–∞—è –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è** (XOR plaintext'–æ–≤)
- –° –æ–¥–Ω–∏–º long-lived –∫–ª—é—á–æ–º –∏ —Å–ª—É—á–∞–π–Ω—ã–º–∏ nonce –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∫–æ–ª–ª–∏–∑–∏–∏ —Ä–∞—Å—Ç—ë—Ç (birthday paradox)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å counter-based nonce (–≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å)
- –ò–ª–∏ XChaCha20-Poly1305 —Å 192-bit nonce (–Ω–∞–º–Ω–æ–≥–æ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ –¥–ª—è random nonce)
- –ò–ª–∏ –≤–∫–ª—é—á–∏—Ç—å message counter –≤ HKDF derivation

---

## üü¢ –†–∞–∑–¥–µ–ª 7: –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, –≤ –ø—Ä–æ–µ–∫—Ç–µ –µ—Å—Ç—å —Ä—è–¥ —Ö–æ—Ä–æ—à–∏—Ö —Ä–µ—à–µ–Ω–∏–π:

| ‚úÖ –†–µ—à–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤ isolates | `compute()` –¥–ª—è –∫—Ä–∏–ø—Ç–æ ‚Äî –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI |
| ICE candidate buffering | –†–µ—à–∞–µ—Ç race condition WebRTC –ø—Ä–∏ cold start |
| Exponential backoff | WS reconnect —Å —Ä–∞–∑—É–º–Ω—ã–º–∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ (1-30s) |
| HTTP fallback –¥–ª—è signaling | –ì–∞—Ä–∞–Ω—Ç–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–∞ –≤—Å–µ —Ö–æ—Å—Ç—ã |
| FLAG_SECURE | –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –Ω–∞ Android |
| Duress/Wipe/Panic —Å–∏—Å—Ç–µ–º–∞ | –ü—Ä–æ–¥—É–º–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å —É–≥—Ä–æ–∑ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–¥ –¥–∞–≤–ª–µ–Ω–∏–µ–º |
| Progressive lockout | –†–∞–∑—É–º–Ω–∞—è —ç—Å–∫–∞–ª–∞—Ü–∏—è: 30s ‚Üí 1m ‚Üí 5m ‚Üí 30m |
| CallKit integration | Deduplication –º–µ–∂–¥—É WS –∏ FCM |
| DI –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö | `IncomingMessageHandler`, `AuthService` ‚Äî —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ —á–µ—Ä–µ–∑ DI |
| Domain migration | Fallback –º–µ–∂–¥—É —Ö–æ—Å—Ç–∞–º–∏ ‚Äî —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º |
| Message retention policies | –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é |
| Manufacturer-aware settings | Xiaomi, Oppo, Huawei ‚Äî –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–µ–Ω–¥–æ—Ä–∞ |

---

## üìä –†–∞–∑–¥–µ–ª 8: –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–µ—Ä—å—ë–∑–Ω–æ—Å—Ç–∏

| –£—Ä–æ–≤–µ–Ω—å | –ö–æ–ª-–≤–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|--------|----------|
| üî¥ CRITICAL | 5 | –¢—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
| üü† HIGH | 6 | –°–µ—Ä—å—ë–∑–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ |
| üü° MEDIUM | 8 | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏ data-–ø—Ä–æ–±–ª–µ–º—ã |
| üîµ LOW | 4 | –ü—Ä–æ–±–ª–µ–º—ã –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ |
| üü£ CRYPTO | 3 | –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è |
| **–ò—Ç–æ–≥–æ** | **26** | |

### –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫

| # | –°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å | –ü—Ä–æ–±–ª–µ–º–∞ | –§–∞–π–ª |
|---|-------------|----------|------|
| 1 | üî¥ CRITICAL | TURN credentials –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –∫–æ–¥–µ | webrtc_service.dart |
| 2 | üî¥ CRITICAL | –ë–î –Ω–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∞ (sqflite –±–µ–∑ SQLCipher) | database_service.dart |
| 3 | üî¥ CRITICAL | –ù–µ—Ç Certificate Pinning | –í—Å–µ HTTP/WS –≤—ã–∑–æ–≤—ã |
| 4 | üî¥ CRITICAL | PIN: SHA-256 –≤–º–µ—Å—Ç–æ Argon2id | auth_service.dart |
| 5 | üî¥ CRITICAL | Sentry DSN –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ | main.dart |
| 6 | üü† HIGH | CryptoService ‚Äî –Ω–µ singleton, –∫–ª—é—á–∏ –Ω–µ –∑–∞–Ω—É–ª—è—é—Ç—Å—è | crypto_service.dart |
| 7 | üü† HIGH | 170+ print() –≤ production (logcat —É—Ç–µ—á–∫–∏) | –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ |
| 8 | üü† HIGH | –ë–∏–æ–º–µ—Ç—Ä–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è (TODO –≤ –∫–æ–¥–µ) | security_settings_screen.dart |
| 9 | üü† HIGH | Public key –≤ WebSocket URL | config.dart |
| 10 | üü† HIGH | HTTP signaling –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏/–ø–æ–¥–ø–∏—Å–∏ | websocket_service.dart |
| 11 | üü† HIGH | Wipe ‚Äî fail-open –ø—Ä–∏ –æ—à–∏–±–∫–µ | auth_service.dart |
| 12 | üü° MEDIUM | Singleton-–∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω, –∂—ë—Å—Ç–∫–∞—è —Å–≤—è–∑–Ω–æ—Å—Ç—å | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ |
| 13 | üü° MEDIUM | main.dart ‚Äî God Object | main.dart |
| 14 | üü° MEDIUM | WebRTCService ‚Äî –Ω–µ—Ç dispose() –¥–ª—è StreamControllers | webrtc_service.dart |
| 15 | üü° MEDIUM | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ CallKit/CallId –ª–æ–≥–∏–∫–∏ | notification_service.dart, incoming_message_handler.dart |
| 16 | üü° MEDIUM | Race condition –≤ PendingActionsService | pending_actions_service.dart |
| 17 | üü° MEDIUM | –ù–µ—Ç –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ SQLite | database_service.dart |
| 18 | üü° MEDIUM | –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î ‚Äî silent catch | database_service.dart |
| 19 | üü° MEDIUM | verifyPin() ‚Äî async –±–µ–∑ await | auth_service.dart |
| 20 | üîµ LOW | Duress mode timing attack | database_service.dart |
| 21 | üîµ LOW | WS connect –±–µ–∑ timeout | websocket_service.dart |
| 22 | üîµ LOW | Pending messages –±–µ–∑ TTL/–ª–∏–º–∏—Ç–∞ | pending_actions_service.dart |
| 23 | üîµ LOW | –¢–µ–ª–µ–º–µ—Ç—Ä–∏—è –¥–µ–∞–Ω–æ–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | telemetry_service.dart |
| 24 | üü£ CRYPTO | –ù–µ—Ç KDF (HKDF) –ø–æ—Å–ª–µ ECDH | crypto_service.dart |
| 25 | üü£ CRYPTO | –ù–µ—Ç Forward Secrecy / key rotation | crypto_service.dart |
| 26 | üü£ CRYPTO | Nonce uniqueness –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ | crypto_service.dart |

---

## üìã –†–∞–∑–¥–µ–ª 9: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –ø–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### Sprint 1 (–ù–µ–¥–µ–ª—è 1) ‚Äî –ë–ª–æ–∫–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- [ ] **[#1]** –£–±—Ä–∞—Ç—å TURN credentials –∏–∑ –∫–æ–¥–∞ ‚Üí –ø–æ–ª—É—á–∞—Ç—å —á–µ—Ä–µ–∑ API —Å TTL
- [ ] **[#2]** –í–Ω–µ–¥—Ä–∏—Ç—å SQLCipher –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –ë–î
- [ ] **[#3]** –î–æ–±–∞–≤–∏—Ç—å Certificate Pinning –¥–ª—è HTTP –∏ WebSocket
- [ ] **[#4]** –ó–∞–º–µ–Ω–∏—Ç—å SHA-256 –Ω–∞ Argon2id –¥–ª—è PIN —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] **[#8]** –ò—Å–ø—Ä–∞–≤–∏—Ç—å –±–∞–≥ –±–∏–æ–º–µ—Ç—Ä–∏–∏ ‚Äî —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É –≤ AuthService

### Sprint 2 (–ù–µ–¥–µ–ª—è 2) ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- [ ] **[#10]** –ü–æ–¥–ø–∏—Å—å HTTP signals –ø—Ä–∏–≤–∞—Ç–Ω—ã–º –∫–ª—é—á–æ–º
- [ ] **[#7]** –£–±—Ä–∞—Ç—å –≤—Å–µ `print()` –∏–∑ production, –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ DebugLogger
- [ ] **[#11]** –ò—Å–ø—Ä–∞–≤–∏—Ç—å fail-open wipe ‚Üí best-effort pattern
- [ ] **[#5]** Sentry DSN –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ dart-define
- [ ] **[#6]** CryptoService ‚Üí singleton + –∑–∞–Ω—É–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–π –ø—Ä–∏ wipe

### Sprint 3 (–ù–µ–¥–µ–ª—è 3) ‚Äî –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è

- [ ] **[#24]** –ü—Ä–∏–º–µ–Ω–∏—Ç—å HKDF –ø–æ—Å–ª–µ ECDH
- [ ] **[#25]** Ephemeral keys –¥–ª—è —Å–µ—Å—Å–∏–π (–º–∏–Ω–∏–º—É–º ‚Äî session-based PFS)
- [ ] **[#9]** Public key –∏–∑ URL ‚Üí –≤ handshake header
- [ ] **[#26]** Counter-based nonce –∏–ª–∏ XChaCha20-Poly1305

### Sprint 4 (–ù–µ–¥–µ–ª—è 4) ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- [ ] **[#17]** –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã SQLite
- [ ] **[#12]** –í–Ω–µ–¥—Ä–∏—Ç—å DI –≤–º–µ—Å—Ç–æ singleton
- [ ] **[#13]** –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ main.dart
- [ ] **[#15]** –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ CallKit/CallId –ª–æ–≥–∏–∫–∏
- [ ] **[#19]** –°–¥–µ–ª–∞—Ç—å verifyPin() async

### Sprint 5 (–ù–µ–¥–µ–ª—è 5) ‚Äî –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏ –ø–æ–ª–∏—Ä–æ–≤–∫–∞

- [ ] **[#14]** –î–æ–±–∞–≤–∏—Ç—å dispose() –≤ WebRTCService
- [ ] **[#16]** –ú—å—é—Ç–µ–∫—Å –¥–ª—è PendingActionsService
- [ ] **[#18]** –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
- [ ] **[#20]** –ü–æ–≤–µ–¥–µ–Ω–∏–µ duress mode –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] **[#21]** WebSocket connect timeout
- [ ] **[#22]** TTL –∏ –ª–∏–º–∏—Ç –¥–ª—è pending messages
- [ ] **[#23]** Ephemeral ID –¥–ª—è —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç Orpheus –∏–º–µ–µ—Ç **—Ö–æ—Ä–æ—à—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—É—é –±–∞–∑—É** –∏ —Ä—è–¥ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π –≤ –æ–±–ª–∞—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (duress mode, panic wipe, progressive lockout, isolate-based crypto). –û–¥–Ω–∞–∫–æ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∑–∞—è–≤–ª–µ–Ω–Ω–æ–º—É —É—Ä–æ–≤–Ω—é –∑–∞—â–∏—Ç—ã ¬´secure messenger¬ª –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

1. **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏:** —É—Å—Ç—Ä–∞–Ω–∏—Ç—å 5 —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **–í–∞–∂–Ω–æ:** –∏—Å–ø—Ä–∞–≤–∏—Ç—å 6 —Å–µ—Ä—å—ë–∑–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º, –∫–æ—Ç–æ—Ä—ã–µ –æ—Å–ª–∞–±–ª—è—é—Ç security posture
3. **–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ:** –ø—Ä–æ–≤–µ—Å—Ç–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏

–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–π —Å—Ä–æ–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –Ω–∞—Ö–æ–¥–æ–∫: **5 –Ω–µ–¥–µ–ª—å** –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ 1 —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞.

---

*–û—Ç—á—ë—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ white-box –∞–Ω–∞–ª–∏–∑–∞ –ø–æ–ª–Ω–æ–π –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.*
