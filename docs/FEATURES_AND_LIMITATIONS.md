# Orpheus Client — особенности, плюсы, недоработки

## Особенности (то, что отличает реализацию)
- **Идентичность по ключу**: нет телефона/email; public key — “ID”.
- **E2E шифрование сообщений**: шифрование/дешифрование на клиенте (`CryptoService`).
- **Устойчивость сети**:
  - WS реконнект с backoff;
  - обработка смены сети;
  - fallback по доменам (primary → legacy);
  - очередь исходящих сообщений при оффлайне (`PendingActionsService`).
- **Звонки “в реальности”**:
  - буфер ICE до offer;
  - ICE restart при деградации сети;
  - foreground service на время звонка (Android).
- **Privacy‑ориентированные уведомления**: push не показывает текст сообщения.
- **Duress режим**: UI скрывает реальные данные (пустой профиль).

## Плюсы (сильные стороны)
- **Ясное разделение на сервисы**: сеть/крипто/БД/уведомления/безопасность — отдельные модули.
- **Контрактная обработка входящих сообщений**: `IncomingMessageHandler` как единая точка, удобная для тестирования.
- **Best‑effort подход в критичных местах**: фоновые сервисы/уведомления/реконнект не должны “ронять” приложение.
- **Подготовка к миграции инфраструктуры**: механизмы доменного fallback встроены в клиент.

## Недоработки (технический долг и риски)
Сводка ориентирована на то, что влияет на качество и безопасность.

### 1) Безопасность хранения данных на устройстве (высокий приоритет)
- Локальная БД хранит **расшифрованные** сообщения (`DatabaseService`).
- Wipe‑процедура в текущем виде требует отдельной проверки на “физическое” удаление данных с диска (см. `docs/SECURITY_REVIEW.md`).

### 2) Конфигурация WebRTC/TURN (высокий приоритет)
- TURN endpoint и credentials заданы в коде (`webrtc_service.dart`).
  Это риск утечки инфраструктуры и абьюза.

### 3) Аутентификация/авторизация на API (высокий приоритет, системный)
- Некоторые HTTP эндпоинты используют `pubkey` как параметр/заголовок (например support/promo).
  Без серверной привязки к сессии/подписи это может быть слабым местом системы.

### 4) Тестовые пробелы (качество/регрессии)
Источник истины: `docs/TESTING_GAPS.md`.
- Есть области, где важные сценарии закреплены не полностью (UI чата/звонка, интеграции уведомлений и т.п.).

### 5) Наблюдаемость и приватность логов
- Логи полезны, но могут утекать в поддержку/скриншоты.
  Нужна политика: какие данные допускается логировать/экспортировать.


